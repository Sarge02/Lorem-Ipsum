<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title> Dashboard | Titan Finder </title>
        <meta name="description" content="Contractor Dashboard">
        <link rel="stylesheet" href="clientDash.css">
        <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
        <script type="text/javascript" src="script.js"></script>
    </head>   
        <div class="bigBoxContractor profile">
            <a href="dashboardInnerMain.html" onclick="changeParentToIframe('dashboard/dashboardInnerMain.html')">X</a>
            <h2 id="profileName">User</h2>
        </div>

    <script>
        window.addEventListener('message', (event) => {
            if (event.data.action === 'receiveJsonFilePath') {
                const nodeText = event.data.data;
                console.log('Received nodeText in iframe:', nodeText);
                const response = {
                    action: 'passJsonFilePath',
                    result: 'Data received successfully'
                };
                event.source.postMessage(response, event.origin);
                displayJSONName(nodeText);
            }
        });

        function displayJSONName(nodeText){
            const fileName = nodeText;
            const subfolder = 'profileData';
            if(fileName){ 
                const extractionFile = `${subfolder}/${fileName.trim()}_profile.json`; //this is the path
                document.getElementById('profileName').textContent = fileName;
                    fetch(extractionFile).then(response => {
                        if(!response.ok) {
                            throw new Error('Network response was not okay');
                        }
                        return response.json();
                    }).then(jsonData => {
                        if(jsonData.Profile.Name){
                            const name= jsonData.Profile.Name;
                            document.getElementById('profileName').textContent=name + "'s Profile";
                        }else {
                            console.error("The 'Name' field was not found");
                        }
                    }).catch(error => {
                        console.error("Error loading JSON:", error);
                    });
            } else {
                console.error("The json file was not found in localStorage");
            }
    }
    </script>
</html>