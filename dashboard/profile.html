<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title> Dashboard | Titan Finder </title>
        <meta name="description" content="Contractor Dashboard">
        <link rel="stylesheet" href="clientDash.css">
        <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
        <script type="text/javascript" src="script.js"></script>
    </head>   
        <div class="bigBoxContractor profile">
            <div class="profileHeading"> 
                <a href="dashboardInnerMain.html" onclick="changeParentToIframe('dashboard/dashboardInnerMain.html')">X</a>
                <h2 id="profileName">User</h2>
                <button class="editProfileButton" onclick="editProfile()" id="editButton">Edit Profile</button>
            </div>
            <div class="innerProfile">
               <div class="profileRow"><label><b>Name:</b></label><p id="userName" class="profileRowAttribute"></p></div>
               <div class="profileRow"><label><b>Phone Number:</b></label><p id="phoneNumber" class="profileRowAttribute"></p></div>
               <div class="profileRow"><label><b>Email:</b></label><p id="email" class="profileRowAttribute"></p></div>
                <div class="profileRow"><label><b>Self-Description:</b></label><p id="description" class="profileRowAttribute"></p></div>
            </div>
        </div>

    <script>
        window.addEventListener('message', (event) => {
            if (event.data.action === 'receiveJsonFilePath') {
                const nodeText = event.data.data;
                console.log('Received nodeText in iframe:', nodeText);
                const response = {
                    action: 'passJsonFilePath',
                    result: 'Data received successfully'
                };
                event.source.postMessage(response, event.origin);
                displayJSONName(nodeText);
            }
        });

        function displayJSONName(nodeText){
            const fileName = nodeText;
            const subfolder = 'profileData';
            if(fileName){ 
                const extractionFile = `${subfolder}/${fileName.trim()}_profile.json`; //this is the path
                document.getElementById('profileName').textContent = fileName;
                    fetch(extractionFile).then(response => {
                        if(!response.ok) {
                            throw new Error('Network response was not okay');
                        }
                        return response.json();
                    }).then(jsonData => {
                        if(jsonData.Profile.Name){
                            const name= jsonData.Profile.Name;
                            document.getElementById('profileName').textContent=name + "'s Profile";
                            document.getElementById('userName').textContent=jsonData.Profile.Name;
                            document.getElementById('phoneNumber').textContent=jsonData.Contact.Phone;
                            document.getElementById('email').textContent=jsonData.Contact.Email;
                            document.getElementById('description').textContent=jsonData.Description.Experience;
                        }else {
                            console.error("The 'Name' field was not found");
                        }
                    }).catch(error => {
                        console.error("Error loading JSON:", error);
                    });
            } else {
                console.error("The json file was not found in localStorage");
            }
    }

    const originalElements = {
        userName: document.getElementById('userName'),
        phoneNumber: document.getElementById('phoneNumber'),
        email: document.getElementById('email'),
        description: document.getElementById('description'),
    };

    const editButton = document.getElementById('editButton');
        const saveButton = document.createElement('button');
    function editProfile(){
        replaceWithInput('userName');
        replaceWithInput('phoneNumber');
        replaceWithInput('email');
        replaceWithInput('description');
        saveButton.className = editButton.className;
        saveButton.textContent = "Save";
        editButton.parentNode.replaceChild(saveButton, editButton);
    }

    function replaceWithInput(id) {
        const textElement = document.getElementById(id);
        const inputField = document.createElement('input');
        inputField.value = textElement.textContent;
        inputField.className = textElement.className;
        textElement.parentNode.replaceChild(inputField, textElement);
    }

    function revertToOriginal() {
        for (const id in originalElements) {
            const inputField = document.getElementById(id);
            const textElement = originalElements[id];
            textElement.textContent = inputField.value;
            inputField.parentNode.replaceChild(textElement, inputField);
        }
        saveButton.parentNode.removeChild(saveButton);
    }

    saveButton.addEventListener('click', revertToOriginal);
    </script>
</html>